<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Free OSINT Toolkit</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>Free OSINT Toolkit</h1>
      <p>
        Privacy-first utilities: Password breach scan · Email lookup · Image
        metadata
      </p>
    </header>

    <main class="grid">
      <!-- Password Breach Scanner -->
      <section class="card">
        <h2>Password Breach Scanner</h2>
        <form id="passwordForm">
          <input
            type="password"
            name="password"
            placeholder="Enter password"
            required
          />
          <button type="submit">Scan</button>
        </form>
        <div id="passwordResult"></div>
      </section>

      <!-- Email Lookup -->
      <section class="card">
        <h2>Email Lookup</h2>
        <form id="emailForm">
          <input
            type="email"
            name="email"
            placeholder="name@example.com"
            required
          />
          <button type="submit">Lookup</button>
        </form>
        <div id="emailResult"></div>
      </section>

      <!-- Image Metadata Extractor -->
      <section class="card">
        <h2>Image Metadata Extractor</h2>
        <form id="imageForm" enctype="multipart/form-data">
          <input type="file" name="image" accept="image/*" required />
          <button type="submit">Upload</button>
        </form>
        <pre id="imageResult"></pre>
      </section>
    </main>

    <footer>
      <small>Built with Python + Flask</small>
    </footer>

    <script>
      // Password Form
      document
        .getElementById("passwordForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(this);
          const res = await fetch("/scan-password", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          const out = document.getElementById("passwordResult");
          if (data.error) {
            out.textContent = "Error: " + data.error;
            out.style.color = "red";
          } else if (data.breached) {
            out.textContent = ` This password appeared ${data.count.toLocaleString()} times in breaches!`;
            out.style.color = "darkred";
          } else {
            out.textContent = "This password was NOT found in known breaches.";
            out.style.color = "green";
          }
        });

      // Email Form
      document
        .getElementById("emailForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(this);
          const res = await fetch("/lookup-email", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          const out = document.getElementById("emailResult");
          if (data.error) {
            out.textContent = "Error: " + data.error;
            out.style.color = "red";
          } else {
            out.textContent = data.status;
            out.style.color = "blue";
          }
        });

      // Image Metadata Form
      document
        .getElementById("imageForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(this);
          const res = await fetch("/extract-image", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          const out = document.getElementById("imageResult");
          if (data.error) {
            out.textContent = "Error: " + data.error;
          } else if (data.metadata && Object.keys(data.metadata).length > 0) {
            out.textContent = JSON.stringify(data.metadata, null, 2);
          } else {
            out.textContent = data.message || "No metadata found.";
          }
        });
    </script>
  </body>
</html>
